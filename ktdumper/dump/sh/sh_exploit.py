import usb.core

from dump.dumper import Dumper


class ShExploit(Dumper):

    def parse_opts(self, opts):
        super().parse_opts(opts)

        self.jump_dst = opts["jump_dst"]

    def execute(self, dev, output):
        try:
            dev.ctrl_transfer(0x00, 55, 0x00, self.jump_dst & 0xFFFF, self.jump_dst >> 16)
        except usb.core.USBTimeoutError:
            pass
        except Exception as e:
            print("")
            print("!! Received an unexpected exception {}".format(e))
            print("!! This most likely indicates that either your kernel or libusb aren't patched properly")
            print("")
            raise
